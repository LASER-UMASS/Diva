############################################################################
#
#  Primary targets:
#    all           - the default target; synonym for 'coq'
#    coq           - builds all .vo files
#    doc           - synonym for 'documentation'
#    install       - copy to coq library location
#    clean         - removes generated files
#
#  Other targets (intended to be used by the developers of this library):
#    gens          - builds generated .v files on demand
#    dist          - builds a zip file for distribution
#
############################################################################

## Paths to executables. Do not include options here.
## Modify these to suit your Coq installation, if necessary.

## If you get warnings such as:
## *** Warning: in file AssocList.v, library CoqFSetDecide is required and has not been found in the loadpath!
## you can use a shell variable to set the load path. (Somehow the -I below is being ignored.)
## export COQPATH=.

COQC = coqc
COQDEP = coqdep
COQDOC = coqdoc


## Library name used for the imports in Coq

LIBNAME=Stlc

## Name of the submakefile generated by coq_makefile

COQMKFILENAME=CoqSrc.mk


############################################################################

.PHONY: all clean coq dist doc gens
.SUFFIXES: .v .vo .v.d .v.glob

all: coq

%.mk : Makefile _%
	coq_makefile -f _$* -o $*.mk

$(COQMKFILENAME): Makefile
	{ echo "-R . $(LIBNAME) " ; ls *.v ; } > _CoqProject && coq_makefile -f _CoqProject -o $(COQMKFILENAME)

coq: $(COQMKFILENAME)
	@$(MAKE) -f $(COQMKFILENAME)

doc:
	@$(MAKE) -f $(COQMKFILENAME) html

install:
	@$(MAKE) -f $(COQMKFILENAME) install

clean:
	@$(MAKE) -f $(COQMKFILENAME) clean
	rm -if $(COQMKFILENAME)


############################################################################
